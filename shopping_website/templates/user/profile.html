{% extends "base.html" %}

{% block title %}個人資料{% endblock %}

{% block content %}
<h2>個人資料</h2>
<p class="text-muted">
  這裡可以查看與更新目前登入帳號的基本資料（帳號、姓名與 Email），以及變更登入密碼。
</p>

{% if error_message %}
  <div class="alert alert-error">
    {{ error_message }}
  </div>
{% endif %}

{% if success_message %}
  <div class="alert alert-success">
    {{ success_message }}
  </div>
{% endif %}

{# ✅ 這裡改成用 user，而不是 profile #}
{% if user %}
  <!-- 基本資料表單 -->
  <form method="post" class="mb-3">
    <input type="hidden" name="action" value="update_profile">

    <label>
      帳號（僅供顯示）
      <input type="text" value="{{ user['username'] }}" disabled>
    </label>

    <label>
      姓名
      <input type="text" name="full_name" value="{{ user['full_name'] }}">
    </label>

    <label>
      Email
      <input type="email" name="email" value="{{ user['email'] or '' }}">
    </label>

    <label>
      角色（僅供顯示）
      <input type="text" value="{{ user['role'] }}" disabled>
    </label>

    <div class="mt-2 text-right">
      <button type="submit">儲存基本資料</button>
    </div>
  </form>

  <hr>

  <!-- 變更密碼表單 -->
  <h3>變更密碼</h3>
  <form method="post">
    <input type="hidden" name="action" value="change_password">

    <label>
      目前密碼
      <input type="password" name="current_password" required>
    </label>

    <label>
      新密碼
      <input type="password" name="new_password" required>
    </label>

    <label>
      再次輸入新密碼
      <input type="password" name="new_password_confirm" required>
    </label>

    <div class="mt-2 text-right">
      <button type="submit">更新密碼</button>
    </div>
  </form>
{% else %}
  <p class="text-muted">
    找不到目前使用者的資料，請重新登入後再試一次。
  </p>
{% endif %}
{% endblock %}

