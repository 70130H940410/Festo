{% extends "base.html" %}

{% block title %}工廠運作模擬 - 智慧工廠下單系統{% endblock %}

{% block content %}
<h2>工廠運作模擬 (Demo)</h2>
<p class="text-muted">
  這個頁面示意 MES / 產線實際運作時的流程進度。之後可以改成由 PLC / MES 回寫每個步驟狀態，
  前端只要定期讀取資料庫並更新畫面即可。
</p>

<div class="card">
  <h3>訂單資訊</h3>
  <p class="text-muted">
    以下為示意資料，未來會連動實際的訂單編號與下單人資訊。
  </p>

  <table>
    <tbody>
      <tr>
        <th style="width: 140px;">訂單編號</th>
        <td>#{{ order_info.id }}</td>
      </tr>
      <tr>
        <th>下單人</th>
        <td>{{ order_info.user_name }}</td>
      </tr>
      <tr>
        <th>目前狀態</th>
        <td>
          {% if order_info.status == "in_progress" %}
            <span class="text-muted">產線進行中…</span>
          {% elif order_info.status == "done" %}
            <span class="text-muted">已完成</span>
          {% else %}
            <span class="text-muted">{{ order_info.status }}</span>
          {% endif %}
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="card">
  <h3>製程步驟進度</h3>
  <p class="text-muted">
    綠色代表已完成、藍色代表進行中、灰色代表尚未開始。之後可以由 MES 寫回每個步驟的狀態欄位，
    例如 <code>pending / running / finished</code>。
  </p>

  <ul class="timeline" id="timeline">
    {% for s in steps %}
    <li class="timeline-step {{ s.status }}">
      <strong>Step {{ s.step_order }}:</strong> {{ s.step_name }}
      {% if s.status == "finished" %}
        <span class="text-muted">（已完成）</span>
      {% elif s.status == "running" %}
        <span class="text-muted">（進行中…）</span>
      {% else %}
        <span class="text-muted">（尚未開始）</span>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
</div>

<div class="card">
  <h3>下一步操作</h3>
  <p class="text-muted">
    Demo 版本中，你可以：
  </p>
  <ul class="text-muted">
    <li>觀察流程時間軸樣式，作為期末報告操作示意</li>
    <li>說明未來如何由 MES 端更新每個步驟的狀態</li>
    <li>說明前端只要定期輪詢（polling）或用 WebSocket 就可以即時更新畫面</li>
  </ul>

  <div class="mt-2 text-right">
    <a class="btn btn-secondary" href="{{ url_for('order.order_page') }}">
      返回重新下單
    </a>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {# 若之後要做 running 步驟點點跳動，可以在這裡載入 factory_simulate.js #}
  {# <script src="{{ url_for('static', filename='js/factory_simulate.js') }}"></script> #}
{% endblock %}


