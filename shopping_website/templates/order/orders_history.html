{% extends "base.html" %}
{% block title %}我的訂單紀錄{% endblock %}

{% block content %}
<h2 class="page-title">我的訂單紀錄</h2>
<p class="text-muted">可查看你的歷史訂單；若被拒絕/取消，備註會顯示原因。</p>

<div class="table-wrap">
  <table class="table-orders table-user-orders">
    <thead>
      <tr>
        <th>訂單編號</th>
        <th>時間</th>
        <th>商品</th>
        <th>數量</th>
        <th>總價</th>
        <th>狀態</th>
        <th>備註</th>
        <th>操作</th>
      </tr>
    </thead>

    <tbody>
      {% if orders and orders|length > 0 %}
        {% for o in orders %}
          {% set is_rejected = (o["status"] == "rejected") %}
          {% set is_cancelled = (o["status"] == "cancelled") %}

          <tr class="{% if is_rejected %}row-rejected{% endif %} {% if is_cancelled %}row-cancelled{% endif %}">
            <td class="mono">{{ o["order_id"] }}</td>
            <td>{{ o["date"] }}</td>
            <td class="cell-wrap">{{ o["product"] }}</td>
            <td>{{ o["amount"] }}</td>
            <td>{{ o["total_price"] }}</td>

            <td>
              {% if is_rejected %}
                <span class="badge badge-danger">已拒絕</span>
              {% elif is_cancelled %}
                <span class="badge badge-muted">已取消</span>
              {% else %}
                <span class="badge badge-success">處理中</span>
              {% endif %}
            </td>

            <td class="cell-note">{{ o["note"] }}</td>

            <td class="cell-actions">
              {% if (not is_rejected) and (not is_cancelled) %}
                <form class="actions-row"
                      method="post"
                      action="{{ url_for('order.cancel_my_order', order_id=o['order_id']) }}"
                      onsubmit="return confirm('確定要取消這筆訂單嗎？');">

                  <button type="submit" class="btn btn-danger btn-cancel">取消訂單</button>

                  <select name="reason" required class="select-reason">
                    <option value="" disabled selected>選擇取消原因</option>
                    <option value="改變心意">改變心意</option>
                    <option value="要修改訂單">要修改訂單</option>
                    <option value="下錯商品/數量">下錯商品/數量</option>
                    <option value="其他原因">其他原因</option>
                  </select>

                </form>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="8" class="text-center text-muted">目前沒有訂單紀錄</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}



