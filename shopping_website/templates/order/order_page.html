{% extends "base.html" %}

{% block title %}我要下單 - 智慧工廠下單系統{% endblock %}

{% block content %}
<h1>我要下單</h1>
<p class="text-muted">
  請選擇要生產的產品與數量，系統會在下一步協助你規劃製程流程。
</p>

{% if error_message %}
  <div class="alert alert-error">
    {{ error_message }}
  </div>
{% endif %}

<form id="order-form" method="post">
  <table>
    <thead>
      <tr>
        <th style="width: 100px;">圖片</th>
        <th>產品名稱</th>
        <th>說明</th>
        <th>單價</th>
        <th>庫存</th>
        <th>本次下單數量</th>
      </tr>
    </thead>
    <tbody>
      {% for p in products %}
      <tr>
        <td>
          <img 
            src="{{ url_for('static', filename='img/' ~ p.name ~ '.jpg') }}" 
            alt="{{ p.name }}"
            style="width: 64px; height: 64px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd;"
            onerror="this.src='https://placehold.co/64x64?text=No+Image'; this.onerror=null;"
          >
        </td>
        <td>{{ p.name }}</td>
        <td>{{ p.description or '-' }}</td>
        <td>{{ p.base_price }}</td>
        <td>{{ p.stock }}</td>
        <td>
          <input
            type="number"
            name="qty_{{ p.id }}"
            class="order-qty-input"
            data-product-name="{{ p.name }}"
            min="0"
            max="{{ p.stock }}"
            value="0"
            style="width: 80px;"
            data-base-price="{{ p.base_price }}"
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="card mt-2">
    <h3>本次下單摘要</h3>
    <p id="order-summary-text" class="text-muted">
      目前尚未選擇任何產品。
    </p>
    <h2 id="total-price-display" style="color: #2c3e50; margin-top: 10px; display:none;">
      總金額：$0
    </h2>
  </div>

  <div class="text-right mt-2">
    <button type="submit">下一步：製程規劃</button>
  </div>
</form>

<!-- 這一頁專用的前端邏輯 -->
<script src="{{ url_for('static', filename='js/order_page.js') }}"></script>
{% endblock %}

